<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
        <changeSet context="legacy" author="Melchakov Sergej" id="2-domain-some-domain">
           <tagDatabase tag="initialState"/>
            <!--       <rollback>
                           DROP TABLE comments, tags, tags_tasks, tasks, users;
                           DROP TABLE tags;
                           DROP TABLE tags_tasks;
                           DROP TABLE tasks;
                           DROP TABLE users;

                       </rollback>     -->
    </changeSet>
    <changeSet context="legacy" author="Melchakov Sergej" id="1-domain-some-domain">

        <sql>create table if not exists tags
        (
            tag_id bigint generated by default as identity
            primary key,
            str    varchar(100)
            );

        alter table tags
            owner to anton;

        create table if not exists tasks
        (
            task_id      bigint generated by default as identity
            primary key,
            create_date  timestamp(6),
            end_date     timestamp(6),
            name         varchar(255),
            start_date   timestamp(6),
            status       varchar(255)
            constraint tasks_status_check
            check ((status)::text = ANY
        ((ARRAY ['NOT_STARTED'::character varying, 'IN_PROGRESS'::character varying, 'DONE'::character varying, 'EXPIRED'::character varying])::text[])),
            task_title   varchar(255),
            user_user_id bigint
            constraint ukhprpqsupc4p9qyl6n0u3g1gx1
            unique
            );

        alter table tasks
            owner to anton;

        create table if not exists comments
        (
            id              bigint generated by default as identity
            primary key,
            comment_of_task varchar(512),
            user_type       varchar(32600),
            task_id         bigint
            constraint fki7pp0331nbiwd2844kg78kfwb
            references tasks
            );

        alter table comments
            owner to anton;

        create table if not exists tags_tasks
        (
            tag_id  bigint not null
            constraint fklhcgwyvm8pp01yi8srs528mjw
            references tasks,
            task_id bigint not null
            constraint fkiopgkmxr44dpd52kii4a6kqgv
            references tags,
            primary key (tag_id, task_id)
            );

        alter table tags_tasks
            owner to anton;

        create table if not exists users
        (
            user_id      bigint not null
            primary key,
            password     varchar(100),
            user_name    varchar(100),
            task_task_id bigint
            constraint ukieytm90uffo7xmccespxj894h
            unique
            constraint fk87kqume4h0d171l3ingil6xxo
            references tasks
            );

        alter table users
            owner to anton;

        alter table tasks
            add constraint fkpmrsaikug4g2ia9g3ndhnmnf5
                foreign key (user_user_id) references users;

        </sql>
        <rollback>
            DROP TABLE comments, tags, tags_tasks, tasks, users;
            <!--DROP TABLE tags;
            DROP TABLE tags_tasks;
            DROP TABLE tasks;
            DROP TABLE users;   -->
        </rollback>
        <!--<tagDatabase tag="""initialState"/>-->
    </changeSet>

</databaseChangeLog>